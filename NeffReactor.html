<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="Author" content="Leslie Bondaryk" />
	<meta name="Owner" content="Pearson" />
	<meta name="Copyright" content="Copyright (c) 2013 Pearson. All rights reserved." />
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="eCourses Author, Title" name="description" />

    <!-- Bootstrap -->
    <link href="css/bootstrap_eCourses_customized.css" rel="stylesheet" media="screen" />
	<link href="css/bootstrap_eCourses_responsive.css" rel="stylesheet" media="screen" />
	<link href="css/graphics_and_svg.css" rel="stylesheet" />
	<link href="css/learning-objective.css" rel="stylesheet" />
	<link href="css/eCourse-master.css" rel="stylesheet" media="screen" />

	<title class="setTitle"></title>
</head>

<body>
	<div class="titler">
		<span class='number setId'></span>
		<span class="setTitle">How do nuclear reactors work?</span>
	</div>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span8 leftCol">
            	<p>Nuclear reactors use heat from fission reactions to turn water into steam, which spins turbines connected to generators that produce electricity. The figure shows a common design known as a pressurized water reactor.</p>
			</div>
			<div class="span6 rightCol">
            	<div id="roto">
                	<p> <span id="alpha"></span>  <span id="Rotate"></span>
                	</p>
                </div>
			</div>
		</div>
        <div class="row-fluid">
			<div class="span8 leftCol">
            	<div id="imgReactor">
                </div>
			</div>
            <div class="span4 rightCol">
            	<div id="steps">
                </div>
			</div>
		</div>
	</div>

	<script src="js/jquery-latest.js"></script>
	<script src="js/d3.v2.min.js"></script>
	<script src="js/toc-structure.js"></script>
	<script src="js/eCourse-master.js"></script>
	<script src="js/widgets.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/eventmanager.js"></script>

	<script>



	//the eventManager is an object that is specific to this page.  A new one
	//is created for every page, and then passed to the widgets in that page
	//that must talk to it.
	var eventManager = new EventManager();
	


	var svgImg = new MakeSVGContainer(
		{
			node: d3.select("#imgReactor"),
			maxWid: 750,
			maxHt: 390
		});

	svgImg.Axes( 
		{
			
			xPosPerc: 0, yPosPerc:0,
			xPerc: 1, yPerc: 1,
			xaxisType: "linear", yaxisType: "linear",
			xTicks: 0,
			xOrient: "bottom",
			yOrient: "left",
			xLabel: "Nuclear Reactor Schematic"
		});

		
	svgImg.ScalableImage({
		images: [
		{URI: "img/reactor.jpg", caption: "Nuclear Reactor schematic"}
		],
		});//this doesn't have an eventmanager argument, because it isn't
	//emitting events in this page.  
	svgImg.Labels (
		{type: "numbered",
		labels: 	
		  [
		{content: "1", xyPos: [.03,.18], width: 0},
		{content: "2", xyPos: [.08,.38], width: 0},
		{content: "3" , xyPos: [.32,.63], width: 0},
		{content: "4" , xyPos: [.64,.58], width: 0},
		{content: "5" , xyPos: [.68,.09], width: 0}
		]}, eventManager);

	
	// Create the callout array.  These won't emit events, just get them.
	var callOuts = new Callouts({
		node: d3.select("#steps"),
		textBits: [
		{content: 
		"1. In a closed circuit, (green) water is pumped at high pressure to the reactor core."},
		{content: 
		"2. Heat is generated by fission in the fuel rods in the reactor core, which heats the circulating water. Thick layers of concrete and steel or lead contain the reactor coreâ€™s radioactivity."},
		{content: 
		"3. In the steam generator, the energy from the heated water is used to boil water from a separate supply. The resulting steam moves through a pipe to a turbine."},
		{content: 
		"4. The steam turns the turbine, which is connected to an electricity generator. Power lines distribute the electricity. A typical reactor produces as much as a coal-fired power plant."},
		{content: 
		"5. A third supply of water is used to cool the steam so it condenses into water, which is pumped back to the steam generator."}
		]
	});
	
	
	
 

	// Modify the value of the data for the bar graph when the
	//numerical input changes.  So, subscribe to the event emitted by inputLevo,
	//or inputDextro,
	//and target whatever is identified by the handler in the second argument.
	//TODO: make these methods of the target widget?

	// Handle changes of the levo and dextro input values
	eventManager.subscribe(svgImg.SelectedEventId,
						   function(ed) { handleSelectionChanged(callOuts, ed.value); });
	 
	

	/* **************************************************************************
	 * handleSelectionChanged                                              *//**
	 *
	* handleInputValueChanged is called from the event handler for one of
	* the input widgets when the user changes its value. It updates the
	* given matching input widget's value to match the new value and then
	* updates the bar chart.
	*
	* @param {NumericInput} otherInputWidget -This is the other input widget
	*                                         whose value needs to be updated
	*                                         to match the user changed widget.
	* @param {number} newValue - The value of the widget that was changed.
	*
	****************************************************************************/
	function handleSelectionChanged(InputWidget, newValue)
	{
		callOuts.displayCallouts(newValue);
	}
	
	
	/* **************************************************************************
	 * handleNumericInputChanged                                            *//**
	 *
	* handleInputValueChanged is called from the event handler for one of
	* the input widgets when the user changes its value. It updates the
	* given matching input widget's value to match the new value and then
	* updates the bar chart.
	*
	* @param {NumericInput} Otherwidgetarray -These are the other widgets
	*                                         which need to be updated
	*                                         to match the user changed widget.
	* @param {number} newValue - The value of the widget that was changed.
	*
	****************************************************************************/
	function handleNumericInputChanged(WidgetList, newValue)
	{
	//	var diff = inputDextro.getValue() - inputLevo.getValue();
	//	var angle = newValue * diff/100;
	//	rot.setValue(newValue * diff/100);
		updatePieChart();
	}

	/* **************************************************************************
	 * updateBarChart                                                       *//**
	 *
	 * updateBarChart updates the bar chart widget to match the current values
	 * of the levo and dextro input widgets.
	 *
	 ****************************************************************************/
	function updateBarChart()
	{
		console.log("TODO: fired updateBarChart log");
		levoData[0].x = inputLevo.getValue();
		dextroData[0].x = inputDextro.getValue();
		svg70.BarChart({
			Data: [dextroData, levoData],
			type: "linear" //ignored for anything but grouped
			});
		var newMark = (levoData[0].x > dextroData[0].x) ? dextroData[0] : levoData[0];
		svg70.LineMarkers( {
			xMarks: [newMark]
			});
		
	}

	function updatePieChart()
	{
		console.log("TODO: fired updatePieChart log");
		pieDish.Pie({
			Data: [{x:rot.getValue()/3.6}],
			xYPos: [0.5,0.5]
			});
		var newMark = {x:(1/2), label: d3.format("+0r2")(rot.getValue()) + "&deg;"};
		pieDish.LineMarkers( {
			xMarks: [newMark]
			});
		
	}
		
	
	</script>
</body>
</html>
